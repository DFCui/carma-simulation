<!--
 Copyright (C) 2021 LEIDOS.

 Licensed under the Apache License, Version 2.0 (the "License"); you may not
	@@ -13,6 +12,18 @@
 WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 License for the specific language governing permissions and limitations under
 the License.
 
 That file has the following license and some code snippets from it may be present in this file as well and are under the same license.

 Copyright (c) 2019 Intel Corporation

 This work is licensed under the terms of the MIT license.
 For a copy, see <https://opensource.org/licenses/MIT>.
-->
<launch>
  <arg name='host' default='localhost'/>
  <arg name='port' default='2000'/>
  <arg name='timeout' default='10'/>
  <arg name="vehicle_filter" default="vehicle.*" />
  <arg name="role_name" default="virtual_vehicle"/>
  <!-- use comma separated format "x,y,z,roll,pitch,yaw" -->
  <arg name="spawn_point" default=""/>
  <arg name="remap_rviz_initialpose_goal" default="True"/>
  <arg name="spawn_virtual_vehicle" default="True" />

  <param name="/carla/host" value="$(arg host)" />
  <param name="/carla/port" value="$(arg port)" />
  <param name="/carla/timeout" value="$(arg timeout)" />

  <!-- 
    If enabled, remap topics to support setting initialpose and goal with RVIZ

    This does not work for multiple ego-vehicles.
  -->
  <group if="$(eval remap_rviz_initialpose_goal)">
    <node pkg="topic_tools" type="relay" name="goal_relay_$(arg role_name)" args="/move_base_simple/goal /carla/$(arg role_name)/goal"/>
    <node pkg="topic_tools" type="relay" name="initialpose_relay_$(arg role_name)" args="/initialpose /carla/$(arg role_name)/initialpose"/>
  </group>

  <node pkg="carla-carma-vehicle" type="carla-carma-vehicle.py" name="carla-carma-vehicle_$(arg role_name)" output="screen">
    <param name="sensor_definition_file" value="$(arg sensor_definition_file)" />
    <param name="vehicle_filter" value="$(arg vehicle_filter)" />
    <param name="spawn_point" value="$(arg spawn_point)" />
    <param name="role_name" value="$(arg role_name)" />
    <param name="spawn_virtual_vehicle" value="$(arg spawn_virtual_vehicle)" />
  </node>
</launch>